{
    "$schema": "https://json-schema.org/draft/2019-09/schema",
    "$id": "https://github.com/EbiEga/ega-metadata-schema/tree/main/schemas/EGA.dataset.json",
    "type": "object",
    "title": "EGA dataset metadata schema",
    "meta:version": "0.0.0",
    "description": "Metadata schema used by the European Genome-phenome Archive (EGA) to validate its Dataset metadata object. This object is intended to contain metadata about the collection of file-containing objects (ArrayAssay, runs or analyses) subject to controlled access. In other words, a dataset encompasses a set of objects to which access is granted as a whole, since access given to a data requester is access to a dataset, and fall under the same Policy. Further details can be found in the EGA-metadata-schema GitHub repository (https://github.com/EbiEga/ega-metadata-schema/tree/main/schemas) and EGA-archive website (https://ega-archive.org/studies)",
    "required": ["object_id", "object_title", "dataset_design"],
    "additionalProperties": false,
    "properties": {
      "object_id": {
        "type": "object",
        "title": "Object's IDs block",
        "description": "Node containing the main identifiers of the object (e.g. alias, center_name...), inherited from the common definitions. #! We extend the core object (object_core_id) by adding a pattern check based on this schema's nature: an dataset (by using EGA-dataset-id-pattern)", 
        "allOf": [
          {
            "title": "Inherited object_core_id object",
            "$ref": "https://github.com/EbiEga/ega-metadata-schema/tree/main/schemas/EGA.common-definitions.json#/definitions/object_core_id"
          },
          {
            "title": "Check that dataset EGA ID (EGAD) is correct",
            "properties": {
              "ega_accession": {
                "$ref": "https://github.com/EbiEga/ega-metadata-schema/tree/main/schemas/EGA.common-definitions.json#/definitions/EGA-dataset-id-pattern"
              }
            }
          }
        ]        
      },

      "schema_descriptor": {
        "title": "Schema descriptor node",
        "description": "Inherited schema descriptor node containing metadata about the schemas and standards used to create the JSON document itself.",
        "$ref": "https://github.com/EbiEga/ega-metadata-schema/tree/main/schemas/EGA.common-definitions.json#/definitions/schema_descriptor"
      },

      "object_title": {
        "type": "string",
        "title": "Title of the dataset",
        "description": "Free-form title of the Dataset. It should be the first picture of the dataset content and not contain more than 30 words. It can be used to call out dataset records in searches or displays.",
        "examples": [ "EBI colon cancer dataset" ]
      },

      "object_description": {
        "type": "string",
        "title": "Description of the dataset",
        "description": "More extensive free-form description of the Dataset. It should include the content of the dataset (number of samples, file types, technology/protocol used to obtain the dataâ€¦) and not extend more than 4 sentences.",
        "examples": [ "This dataset is related to Project X by grant Y and encompasses samples from group Z, whose DNA was hybridez against a microarray designed for SNPs." ]
      },

      "dataset_design": {
        "type": "object",
        "title": "Dataset design",
        "description": "Node to present a controlled vocabulary for expressing the overall purpose of the dataset with certain keywords.",
        "required": ["dataset_types"],
        "additionalProperties": false,
        "properties": {
          "dataset_types": {
            "type": "array",
            "title": "List of dataset types",
            "description": "A list of dataset type pairs.",
            "minItems": 1,
            "additionalProperties": false,
            "items": { 
              "type": "object",
              "title": "Dataset type pairs",
              "description": "Object consisting in dataset type pairs, consisting in preexisting dataset_types and optional new_dataset_types.",
              "required": ["dataset_type"],
              "additionalProperties": false,
              "properties": {
                "dataset_type": {
                  "$ref": "https://github.com/EbiEga/ega-metadata-schema/tree/main/schemas/EGA.common-definitions.json#/definitions/study-or-dataset-type-list"
                },
                "new_dataset_type": {
                  "type": "string",
                  "title": "New dataset type",
                  "description": "A user-defined free-form term that globally describes the type of the dataset. Use only when the 'dataset_type' controlled vocabulary does not contain it, providing 'other' as such.",
                  "pattern": ".+",
                  "examples": [ "extraterrestial biomaterial analysis" ]
                }
              },
              "allOf": [
                {
                  "if": {
                    "title": "If the dataset_type is 'other'",
                    "required": ["dataset_type"],
                    "properties": {
                      "dataset_type": {
                        "enum": ["other"]
                      }
                    }
                  },
                  "then": {
                    "title": "Then the new_dataset_type has to be present",
                    "required": ["new_dataset_type"]
                  }
                },
                {
                  "if": {
                    "title": "If the dataset_type is NOT 'other'",
                    "required": ["dataset_type"],
                    "properties": {
                      "dataset_type": {
                        "not": {
                          "enum": ["other"]
                        }                  
                      }
                    }
                  },
                  "then": {
                    "title": "Then the new_dataset_type should NOT be present",
                    "properties": {
                      "new_dataset_type": false
                    }
                  }
                }
              ]              
            }            
          },          
          "additional_keywords_list": {
            "type": "array",
            "title": "List of additional keywords of the dataset",
            "description": "A list consisting in user-defined keywords that are directly related to the overall purpose of the dataset, other than the main dataset type. Can be used to call out dataset records in searches or displays.",
            "minItems": 1,
            "additionalProperties": false,
            "items": { 
              "type": ["string"],
              "title": "Individual dataset keyword",
              "description": "One individual keyword of the set.",
              "examples": [ "autoimmune pancreatitis", "cancer", "IgG4-related disease" ]
            }
          }
        }        
      },

      "approximate_release_date": {
        "type": "string",
        "title": "Approximate release date of the dataset",
        "description": "An approximate date of the desired release of the dataset. Bare in mind that this will NOT automatically release the dataset, but instead may be used to set a reminder to the submitter (and EGA's HelpDesk team) in case the dataset was not released by this time. This would help in cases where this step was forgotten by the submitter or release was stalled for some reason.",
        "examples": [ "2023-01-01" ],
        "allOf": [
          {
            "title": "The date has to match the common date pattern",
            "$ref": "https://github.com/EbiEga/ega-metadata-schema/tree/main/schemas/EGA.common-definitions.json#/definitions/EGA-ISO-date-YYYY-MM-DD-pattern"
          },
          {
            "title": "We cap the reminder up to 3 years",
            "Description": "It's our policy to, at some point, release all the data we hold to improve findability. Therefore, we cap the reminder date to 3 years so that we avoid submitters setting a reminder too far in the future, sometimes intentionally.",
            "pattern": "^202[2-5]?.+$"
          }
        ]
      },

      "dataset_relationships": {
        "type": "array",
        "title": "Dataset relationships",
        "description": "Comprises metadata (e.g. Source or Target) of a directional association between two entities. This relationships node contains all the possible relationships between metadata objects, both outside of (e.g. an Array Design Format that was submitted to ArrayExpress being linked to their microarray data within EGA) and within (e.g. a policy being linked to a dataset) the EGA.",
        "minItems": 1,
        "additionalProperties": false,
        "items": { 
          "$ref": "https://github.com/EbiEga/ega-metadata-schema/tree/main/schemas/EGA.common-definitions.json#/definitions/relationship_object" 
        }
      },

      "dataset_attributes": {
        "type": "array",
        "title": "Dataset custom attributes",
        "description": "Custom attributes of a dataset: reusable attributes to encode tag-value pairs (e.g. Tag being 'Targeted loci' and its Value '5:63256183-63258334') with optional units (e.g. 'base pairs'). Its properties are inherited from the common-definitions.json schema.",
        "minItems": 1,
        "additionalProperties": false,
        "items": { 
          "$ref": "https://github.com/EbiEga/ega-metadata-schema/tree/main/schemas/EGA.common-definitions.json#/definitions/custom_attribute" 
        }
      }
      
    }      
  }