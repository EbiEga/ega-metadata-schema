{
    "$schema": "https://json-schema.org/draft/2019-09/schema#",
    "$id": "https://raw.githubusercontent.com/EbiEga/ega-metadata-schema/main/schemas/EGA.experiment.json",
    "type": "object",
    "title": "EGA Experiment metadata schema",
    "meta:version": "1.0.0",
    "required": ["EXPERIMENT_SET"],
    "additionalProperties": false,
    "properties": {
        "EXPERIMENT_SET": {
            "type": "array",
            "description": "An EXPERIMENT_SET is a container for a set of experiments and a common namespace.",
            "minItems": 1,
            "uniqueItems": true,
            "items": {
                "type": "object",
                "required": ["EXPERIMENT"],
                "properties": {
                    "EXPERIMENT": {
                        "$ref": "#/definitions/ExperimentType"
                    }
                }
            }
        }
    },
    "definitions": {
        "ExperimentType": {
            "type": "object",
            "description": "An Experiment specifies what will be sequenced and how the sequencing will be performed.",
            "allOf": [
                { "$ref": "EGA.common.json#/definitions/ObjectType" }
            ],
            "required": ["STUDY_REF", "DESIGN", "PLATFORM"],
            "properties": {
                "TITLE": {
                    "type": "string",
                    "description": "Short text that can be used to call out experiment records in searches or in displays."
                },
                "STUDY_REF": {
                    "type": "object",
                    "description": "Identifies the parent study.",
                    "$ref": "EGA.common.json#/definitions/RefObjectType"
                },
                "DESIGN": {
                    "type": "object",
                    "description": "The library design including library properties, layout, protocol, targeting information, and spot and gap descriptors.",
                    "$ref": "#/definitions/LibraryType"
                },
                "PLATFORM": {
                    "type": "object",
                    "description": "The PLATFORM record selects which sequencing platform and platform-specific runtime parameters.",
                    "$ref": "EGA.common.json#/definitions/PlatformType"
                },
                "PROCESSING": {
                    "type": "object",
                    "description": "Processing parameters for the experiment.",
                    "$ref": "EGA.common.json#/definitions/ProcessingType"
                },
                "EXPERIMENT_LINKS": {
                    "type": "array",
                    "description": "Links to resources related to this experiment or experiment set (publication, datasets, online databases).",
                    "minItems": 1,
                    "uniqueItems": true,
                    "items": {
                      "type": "object",
                      "required": ["EXPERIMENT_LINK"],
                      "properties": {
                          "EXPERIMENT_LINK": {
                                "$ref": "EGA.common.json#/definitions/LinkType"
                          }
                      }
                    }
                },
                "EXPERIMENT_ATTRIBUTES": {
                    "type": "array",
                    "description": "Properties and attributes of the experiment. These can be entered as free-form tag-value pairs.",
                    "minItems": 1,
                    "uniqueItems": true,
                    "items": {
                      "type": "object",
                      "required": ["EXPERIMENT_ATTRIBUTE"],
                      "properties": {
                          "EXPERIMENT_ATTRIBUTE": {
                                "$ref": "EGA.common.json#/definitions/AttributeType"
                          }
                      }
                    }
                }
            }
        },
        "LibraryType": {
            "type": "object",
            "required": ["DESIGN_DESCRIPTION", "SAMPLE_DESCRIPTOR", "LIBRARY_DESCRIPTOR"],
            "properties": {
                "DESIGN_DESCRIPTION": {
                    "type": "string",
                    "description": "Goal and setup of the individual library including how the library was constructed."
                },
                "SAMPLE_DESCRIPTOR": {
                    "type": "object",
                    "description": "Pick a sample to associate this experiment with. The sample may be an individual or a pool, depending on how it is specified.",
                    "$ref": "#/definitions/SampleDescriptorType"
                },
                "LIBRARY_DESCRIPTOR": {
                    "type": "object",
                    "description": "The LIBRARY_DESCRIPTOR specifies the origin of the material being sequenced and any treatments that the material might have undergone that affect the sequencing result. This specification is needed even if the platform does not require a library construction step per se.",
                    "$ref": "#/definitions/LibraryDescriptorType"
                },
                "SPOT_DESCRIPTOR": {
                    "description": "The SPOT_DESCRIPTOR specifies how to decode the individual reads of interest from the monolithic spot sequence. The spot descriptor contains aspects of the experimental design, platform, and processing information. There will be two methods of specification: one will be an index into a table of typical decodings, the other being an exact specification. This construct is needed for loading data and for interpreting the loaded runs. It can be omitted if the loader can infer read layout (from multiple input files or from one input files).",
                    "$ref": "EGA.common.json#/definitions/SpotDescriptorType"
                }
            }
        },
        "SampleDescriptorType": {
            "type": "object",
            "anyOf": [
                { "$ref": "EGA.common.json#/definitions/RefObjectType" },
                {
                    "required": ["POOL"],
                    "properties": {
                        "POOL": {
                            "type": "object",
                            "description": "Identifies a list of group/pool/multiplex sample members. This implies that this sample record is a group, pool, or multiplex, but it continues to receive its own accession and can be referenced by an experiment. By default if no match to any of the listed members can be determined, then the default sample reference is used.",
                            "properties": {
                                "DEFAULT_MEMBER": {
                                    "type": "object",
                                    "description": "Reference to the sample that is used when read membership cannot be determined. A default member should be provided if there exists a possibility that some reads will be left over from barcode/MID resolution. A default member is not needed when defining a true pool (where individual samples are not distinguished in the reads), or the reads have been partitioned among the pool members (no leftovers).",
                                    "$ref": "#/definitions/PoolMemberType"
                                },
                                "MEMBERS": {
                                    "type": "array",
                                    "description": "Reference to the sample as determined from barcode/MID resolution or read partition",
                                    "minItems": 1,
                                    "uniqueItems": true,
                                    "items": {
                                            "$ref": "#/definitions/PoolMemberType"
                                    }
                                }
                            }
                        }
                    }
                }
            ]
        },
        "PoolMemberType": {
            "type": "object",
            "allOf": [
                { "$ref": "EGA.common.json#/definitions/RefObjectType" }
            ],
            "properties": {
                "READ_LABEL": {
                    "type": "array",
                    "minItems": 1,
                    "uniqueItems": true,
                    "items": {
                      "type": "object",
                      "properties": {
                          "value": {
                                "type": "string"
                          },
                          "read_group_tag": {
                                "type": "string",
                                "description": "Assignment of read_group_tag to decoded read"
                          }
                      }
                    }
                },
                "member_name": {
                    "type": "string",
                    "description": "Label a sample within a scope of the pool"
                },
                "proportion": {
                    "type": "number",
                    "description": "Proportion of this sample (in percent) that was included in sample pool."
                }
            }
        },
        "LibraryDescriptorType": {
            "type": "object",
            "required": ["LIBRARY_STRATEGY", "LIBRARY_SOURCE", "LIBRARY_SELECTION", "LIBRARY_LAYOUT"],
            "description": "The LIBRARY_DESCRIPTOR specifies the origin of the material being sequenced and any treatments that the material might have undergone that affect the sequencing result. This specification is needed even if the platform does not require a library construction step per se.",
            "properties": {
                "LIBRARY_NAME": {
                    "type": "string",
                    "description": "The submitter's name for this library."
                },
                "LIBRARY_STRATEGY": {
                    "$ref": "#/definitions/typeLibraryStrategy"
                },
                "LIBRARY_SOURCE": {
                    "$ref": "#/definitions/typeLibrarySource"
                },
                "LIBRARY_SELECTION": {
                    "$ref": "#/definitions/typeLibrarySelection"
                },
                "LIBRARY_LAYOUT": {
                    "type": "object",
                    "description": "LIBRARY_LAYOUT specifies whether to expect single, paired, or other configuration of reads. In the case of paired reads, information about the relative distance and orientation is specified.",
                    "oneOf": [
                      {
                          "description": "Reads are unpaired (usual case).",
                          "required": ["SINGLE"],
                          "properties": {
                                "SINGLE": {
                                  "type": "object"
                                }
                          }
                      },
                      {
                          "description": "In the case of paired reads, information about the relative distance and orientation is specified.",
                          "required": ["PAIRED"],
                          "properties": {
                                "PAIRED": {
                                  "type": "object",
                                  "required": ["NOMINAL_LENGTH", "NOMINAL_SDEV"],
                                  "properties": {
                                    "NOMINAL_LENGTH": {
                                          "type": "integer",
                                          "minimum": 0
                                    },
                                    "NOMINAL_SDEV": {
                                          "type": "number"
                                    }
                                  }
                                }
                          }
                      }
                    ]
                },
                "TARGETED_LOCI": {
                    "type": "array",
                    "description": "Names the gene(s) or locus(loci) or other genomic feature(s) targeted by the sequence.",
                    "minItems": 1,
                    "uniqueItems": true,
                    "items": {
                        "type": "object",
                        "required": ["LOCUS"],
                        "properties": {
                            "LOCUS": {
                                "type": "object",
                                "required": ["locus_name"],
                                "properties": {
                                  "PROBE_SET": {
                                    "type": "object",
                                    "$ref": "EGA.common.json#/definitions/XRefType"
                                  },
                                  "locus_name": {
                                    "type": "string",
                                    "title": "Locus Name",
                                    "description": "Names the gene(s) or locus(loci) or other genomic feature(s) targeted by the sequence.",
                                    "enum": [
                                        "16S rRNA", "18S rRNA", "28S rRNA", "RBCL", "matK", "COX1", "ITS1-5.8S-ITS2", "exome", "other"
                                    ],
                                    "meta:enum": {
                                        "16S rRNA": "Bacterial small subunit ribosomal RNA, a locus used for phylogenetic studies of bacteria and as a target for random target PCR in environmental biodiversity screening.",
                                        "18S rRNA": "Eukaryotic small subunit ribosomal RNA, a locus used for phylogenetic studies of eukaryotes and as a target for random target PCR in environmental biodiversity screening.",
                                        "28S rRNA": "Structural ribosomal RNA for the large component, or large subunit (LSU) of eukaryotic cytoplasmic ribosomes.",
                                        "RBCL": "RuBisCO large subunit : ribulose-1,5-bisphosphate carboxylase/oxygenase large subunit, a locus used for phylogenetic studies of plants.",
                                        "matK": "Maturase K gene, a locus used for phylogenetic studies of plants.",
                                        "COX1": "Mitochondrial cytochrome c oxidase 1 gene, a locus used for phylogenetic studies of animals.",
                                        "ITS1-5.8S-ITS2": "Internal transcribed spacers 1 and 2 plus 5.8S rRNA region, a locus used for phylogenetic studies of fungi.",
                                        "exome": "All exonic regions of the genome.",
                                        "other": "Other locus, please describe."
                                    }
                                  },
                                  "description": {
                                    "type": "string",
                                    "description": "Submitter supplied description of alternate locus and auxiliary information."
                                  }
                                }
                            }
                        }                        
                    }
                },
                "POOLING_STRATEGY": {
                    "type": "string",
                    "description": "The optional pooling strategy indicates how the library or libraries are organized if multiple samples are involved."
                },
                "LIBRARY_CONSTRUCTION_PROTOCOL": {
                    "type": "string",
                    "description": "Free form text describing the protocol by which the sequencing library was constructed."
                }
            }
        },
        "typeLibraryStrategy": {
            "type": "string",
            "title": "Library Strategy",
            "description": "Sequencing technique intended for this library.",
            "enum": [
                "WGS", "WGA", "WXS", "RNA-Seq", "ssRNA-seq", "snRNA-seq", "miRNA-Seq", "ncRNA-Seq", "FL-cDNA", "EST", "Hi-C", "ATAC-seq", "WCS", "RAD-Seq", "CLONE", "POOLCLONE", "AMPLICON", "CLONEEND", "FINISHING", "ChIP-Seq", "MNase-Seq", "DNase-Hypersensitivity", "Bisulfite-Seq", "CTS", "MRE-Seq", "MeDIP-Seq", "MBD-Seq", "Tn-Seq", "VALIDATION", "FAIRE-seq", "SELEX", "RIP-Seq", "ChIA-PET", "Synthetic-Long-Read", "Targeted-Capture", "Tethered Chromatin Conformation Capture", "NOMe-Seq", "ChM-Seq", "GBS", "Ribo-Seq", "OTHER"
            ],
            "meta:enum": {
                "WGS": "Whole Genome Sequencing - random sequencing of the whole genome (see pubmed 10731132 for details)",
                "WGA": "Whole Genome Amplification followed by random sequencing. (see pubmed 1631067,8962113 for details)",
                "WXS": "Random sequencing of exonic regions selected from the genome. (see pubmed 20111037 for details)",
                "RNA-Seq": "Random sequencing of whole transcriptome, also known as Whole Transcriptome Shotgun Sequencing, or WTSS). (see pubmed 18611170 for details)",
                "ssRNA-seq": "Strand-specific RNA sequencing.",
                "snRNA-seq": "Single nucleus RNA sequencing is a method for profiling gene expression in cells which are difficult to isolate.",
                "miRNA-Seq": "Micro RNA sequencing strategy designed to capture post-transcriptional RNA elements and include non-coding functional elements. (see pubmed 21787409 for details)",
                "ncRNA-Seq": "Capture of other non-coding RNA types, including post-translation modification types such as snRNA (small nuclear RNA) or snoRNA (small nucleolar RNA), or expression regulation types such as siRNA (small interfering RNA) or piRNA/piwi/RNA (piwi-interacting RNA).",
                "FL-cDNA": "Full-length sequencing of cDNA templates",
                "EST": "Single pass sequencing of cDNA templates",
                "Hi-C": "Chromosome Conformation Capture technique where a biotin-labeled nucleotide is incorporated at the ligation junction, enabling selective purification of chimeric DNA ligation junctions followed by deep sequencing.",
                "ATAC-seq": "Assay for Transposase-Accessible Chromatin (ATAC) strategy is used to study genome-wide chromatin accessibility. alternative method to DNase-seq that uses an engineered Tn5 transposase to cleave DNA and to integrate primer DNA sequences into the cleaved genomic DNA.",
                "WCS": "Random sequencing of a whole chromosome or other replicon isolated from a genome.",
                "RAD-Seq": "Description not provided",
                "CLONE": "Genomic clone based (hierarchical) sequencing.",
                "POOLCLONE": "Shotgun of pooled clones (usually BACs and Fosmids).",
                "AMPLICON": "Sequencing of overlapping or distinct PCR or RT-PCR products. For example, metagenomic community profiling using SSU rRNA.",
                "CLONEEND": "Clone end (5', 3', or both) sequencing.",
                "FINISHING": "Sequencing intended to finish (close) gaps in existing coverage.",
                "ChIP-Seq": "ChIP-seq, Chromatin ImmunoPrecipitation, reveals binding sites of specific proteins, typically transcription factors (TFs) using antibodies to extract DNA fragments bound to the target protein.",
                "MNase-Seq": "Identifies well-positioned nucleosomes. uses Micrococcal Nuclease (MNase) is an endo-exonuclease that processively digests DNA until an obstruction, such as a nucleosome, is reached.",
                "DNase-Hypersensitivity": "Sequencing of hypersensitive sites, or segments of open chromatin that are more readily cleaved by DNaseI.",
                "Bisulfite-Seq": "MethylC-seq. Sequencing following treatment of DNA with bisulfite to convert cytosine residues to uracil depending on methylation status.",
                "CTS": "Concatenated Tag Sequencing",
                "MRE-Seq": "Methylation-Sensitive Restriction Enzyme Sequencing.",
                "MeDIP-Seq": "Methylated DNA Immunoprecipitation Sequencing.",
                "MBD-Seq": "Methyl CpG Binding Domain Sequencing.",
                "Tn-Seq": "Quantitatively determine fitness of bacterial genes based on how many times a purposely seeded transposon gets inserted into each gene of a colony after some time.",
                "VALIDATION": "CGHub special request: Independent experiment to re-evaluate putative variants.",
                "FAIRE-seq": "Formaldehyde Assisted Isolation of Regulatory Elements. Reveals regions of open chromatin.",
                "SELEX": "Systematic Evolution of Ligands by Exponential enrichment",
                "RIP-Seq": "Direct sequencing of RNA immunoprecipitates (includes CLIP-Seq, HITS-CLIP and PAR-CLIP).",
                "ChIA-PET": "Direct sequencing of proximity-ligated chromatin immunoprecipitates.",
                "Synthetic-Long-Read": "Binning and barcoding of large DNA fragments to facilitate assembly of the fragment.",
                "Targeted-Capture": "Enrichment of a targeted subset of loci.",
                "Tethered Chromatin Conformation Capture": "Description not provided",
                "NOMe-Seq": "Nucleosome Occupancy and Methylome sequencing.",
                "ChM-Seq": "ChIPmentation combines chromatin immunoprecipitation with sequencing library preparation by Tn5 transposase (see pubmed 26280331 for details)",
                "GBS": "Genotyping by sequencing is a method to discover single nucleotide polymorphisms for genotyping studies.",
                "Ribo-Seq": "Ribosome profiling (also named ribosome footprinting) that uses specialized messenger RNA (mRNA) sequencing to determine which mRNAs are being actively translated. It produces a 'global snapshot' of all the ribosomes active in a cell at a particular moment, known as a translatome.",
                "OTHER": "Library strategy not listed."
            }
        },
        "typeLibrarySource": {
            "type": "string",
            "title": "Library Source",
            "description": "The LIBRARY_SOURCE specifies the type of source material that is being sequenced.",
            "enum": [
                "GENOMIC", "GENOMIC SINGLE CELL", "TRANSCRIPTOMIC", "TRANSCRIPTOMIC SINGLE CELL", "METAGENOMIC", "METATRANSCRIPTOMIC", "SYNTHETIC", "VIRAL RNA", "OTHER"
            ],
            "meta:enum": {
                "GENOMIC": "Genomic DNA (includes PCR products from genomic DNA).",
                "GENOMIC SINGLE CELL": "Description not provided",
                "TRANSCRIPTOMIC": "Transcription products or non genomic DNA (EST, cDNA, RT-PCR, screened libraries).",
                "TRANSCRIPTOMIC SINGLE CELL": "Description not provided",
                "METAGENOMIC": "Mixed material from metagenome.",
                "METATRANSCRIPTOMIC": "Transcription products from community targets",
                "SYNTHETIC": "Synthetic DNA.",
                "VIRAL RNA": "Viral RNA.",
                "OTHER": "Other, unspecified, or unknown library source material."
            }
        },
        "typeLibrarySelection": {
            "type": "string",
            "title": "Library Selection",
            "description": "Method used to enrich the target in the sequence library preparation.",
            "enum": [
                "RANDOM", "PCR", "RANDOM PCR", "RT-PCR", "HMPR", "MF", "repeat fractionation", "size fractionation", "MSLL", "cDNA", "cDNA_randomPriming", "cDNA_oligo_dT", "PolyA", "Oligo-dT", "Inverse rRNA", "Inverse rRNA selection", "ChIP", "ChIP-Seq", "MNase", "DNase", "Hybrid Selection", "Reduced Representation", "Restriction Digest", "5-methylcytidine antibody", "MBD2 protein methyl-CpG binding domain", "CAGE", "RACE", "MDA", "padlock probes capture method", "other", "unspecified"
            ],
            "meta:enum": {
                "RANDOM": "No Selection or Random selection",
                "PCR": "Target enrichment via PCR",
                "RANDOM PCR": "Source material was selected by randomly generated primers.",
                "RT-PCR": "Target enrichment via RT-PCR",
                "HMPR": "Hypo-methylated partial restriction digest",
                "MF": "Methyl Filtrated",
                "repeat fractionation": "Selection for less repetitive (and more gene rich) sequence through Cot filtration (CF) or other fractionation techniques based on DNA kinetics.",
                "size fractionation": "Physical selection of size appropriate targets.",
                "MSLL": "Methylation Spanning Linking Library",
                "cDNA": "PolyA selection or enrichment for messenger RNA (mRNA); synonymize with PolyA",
                "cDNA_randomPriming": "Description not provided",
                "cDNA_oligo_dT": "Description not provided",
                "PolyA": "PolyA selection or enrichment for messenger RNA (mRNA); should replace cDNA enumeration.",
                "Oligo-dT": "Enrichment of messenger RNA (mRNA) by hybridization to Oligo-dT.",
                "Inverse rRNA": "Depletion of ribosomal RNA by oligo hybridization.",
                "Inverse rRNA selection": "Depletion of ribosomal RNA by inverse oligo hybridization.",
                "ChIP": "Chromatin immunoprecipitation",
                "ChIP-Seq": "Chromatin immunoPrecipitation, reveals binding sites of specific proteins, typically transcription factors (TFs) using antibodies to extract DNA fragments bound to the target protein.",
                "MNase": "Identifies well-positioned nucleosomes. Uses Micrococcal Nuclease (MNase) is an endo-exonuclease that processively digests DNA until an obstruction, such as a nucleosome, is reached.",
                "DNase": "DNase I endonuclease digestion and size selection reveals regions of chromatin where the DNA is highly sensitive to DNase I.",
                "Hybrid Selection": "Selection by hybridization in array or solution.",
                "Reduced Representation": "Reproducible genomic subsets, often generated by restriction fragment size selection, containing a manageable number of loci to facilitate re-sampling.",
                "Restriction Digest": "DNA fractionation using restriction enzymes.",
                "5-methylcytidine antibody": "Selection of methylated DNA fragments using an antibody raised against 5-methylcytosine or 5-methylcytidine (m5C).",
                "MBD2 protein methyl-CpG binding domain": "Enrichment by methyl-CpG binding domain.",
                "CAGE": "Cap-analysis gene expression.",
                "RACE": "Rapid Amplification of cDNA Ends.",
                "MDA": "Multiple Displacement Amplification, a non-PCR based DNA amplification technique that amplifies a minute quantifies of DNA to levels suitable for genomic analysis.",
                "padlock probes capture method": "Targeted sequence capture protocol covering an arbitrary set of nonrepetitive genomics targets. An example is capture bisulfite sequencing using padlock probes (BSPP).",
                "other": "Other library enrichment, screening, or selection process.",
                "unspecified": "Library enrichment, screening, or selection is not specified."
            }
        }
    }
  }
  